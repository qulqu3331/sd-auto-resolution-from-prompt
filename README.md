# sd-auto-resolution-from-prompt

Stable Diffusion WebUI / Forge 拡張  
プロンプト内の `res_<width>_<height>` 指定に従って、出力解像度を自動で変更します。

---

## 概要

この拡張は、プロンプトに含まれる res_640_960 のような文字列をもとに、生成解像度を自動で変更するための拡張です。  
特に、以下のような Dynamic Prompts のワイルドカード定義と組み合わせて使うことを目的としています：

```yaml
lying_or_standing:
  - 1girl, lying, res_640_960
  - 1girl, standing, res_960_640
# 別の書き方をすると
lying_or_standing: 1girl, {lying, res_640_960|standing, res_960_640}
```

これにより、体勢や構図の変化に紐づけた解像度の変更を、ワイルドカードyamlファイルで一元管理できます。

---

## 免責事項・対応環境について
この拡張は以下の環境でのみ動作確認を行っています：
- Stable Diffusion WebUI Forge（安定版最終）

>❌ Forgeのテスト版（新ブランチ）  
>❌ reForge  
>については、動作確認を行っていません。

また、本拡張はプロンプト内の記述に基づいて生成解像度を動的に変更する性質を持つため、  
他の拡張機能（特に解像度を制御するタイプ）と競合する可能性があります。

環境依存・UI構造・拡張の読み込み順によっては、正常に動作しない・予期しない解像度になるなどの可能性もあります。

本拡張の導入・使用は自己責任でお願いします。  
予期しない挙動や環境破損、生成結果の問題などについて、作者は一切の責任を負いません。

---

## 導入と配置

フォルダごと下記ディレクトリに入れれば動作します。  
先述のDynamic Promptsと組み合わせた使い方をする場合、この拡張は **Dynamic Prompts 拡張より後に実行される必要があります**。  
そのため、拡張フォルダ名は `zzz-` など **辞書順で後になる名前**を推奨します：

```
stable-diffusion-webui-forge/
└── extensions/
    └── zzz-sd-auto-resolution-from-prompt/
        └── scripts/
            └── auto_resolution.py
```

---

## 使用方法

1. `res_<width>_<height>` をプロンプトに含める（例：`res_640_960`）
2. txt2img画面の拡張項目から 「AutoResolution 設定」を開き「プロンプトから解像度を自動設定」にチェックを入れる
3. 起動時にオンにしたい場合は Settings からauto_resolution_default_enabledの項目で設定する。**API生成で有効にしたいときもここで設定**

---


## ありそうな質問

- Q. 解像度指定はプロンプトに残りますか？  
  → いいえ、自動的に除去されます。

- Q. img2img でも使えますか？  
  → 現在は `txt2img` 専用です。

- Q. UIのスライダー（幅・高さ）は自動で動きますか？  
→ いいえ、UIには一切触れません。 解像度は内部的に変更され、出力画像には反映されますが、スライダーの見た目は変わりません。
